fullnameOverride: mirror

global:
  namespaceOverride: ""

grpc:
  config:
    hedera:
      mirror:
        grpc:
          db:
            host: mirror-postgresql
            password: mirror_node_pass
            username: mirror_node
  enabled: true

importer:
  config:
    hedera:
      mirror:
        db:
          host: mirror-postgresql
          name: mirror_node
          password: mirror_node_pass
          username: mirror_node
  enabled: true

labels: {}

loki-stack:
  enabled: true
  loki:
    config:
      table_manager:
        retention_deletes_enabled: true
        retention_period: 2184h
    networkPolicy:
      enabled: true
    persistence:
      enabled: true
    resources:
      limits:
        cpu: 200m
        memory: 256Mi
      requests:
        cpu: 50m
        memory: 64Mi
    serviceMonitor:
      enabled: true
  promtail:
    resources:
      limits:
        cpu: 125m
        memory: 100Mi
      requests:
        cpu: 50m
        memory: 32Mi
    serviceMonitor:
      enabled: true

networkPolicy:
  enabled: true

postgresql:
  enabled: true
  initdbScriptsSecret: mirror-postgresql-init
  master:
    labels:
      role: db
  metrics:
    enabled: true
    securityContext:
      enabled: true
  networkPolicy:
    allowExternal: false
    enabled: true
  postgresqlDatabase: mirror_node
  postgresqlPassword: password
  replication:
    applicationName: mirror_node
    enabled: false
    numSynchronousReplicas: 1
    password: foobar
    slaveReplicas: 1
    synchronousCommit: "on"
  serviceAccount:
    enabled: true
  serviceMonitor:
    enabled: true
  slave:
    labels:
      role: db

prometheus-adapter:
  prometheus:
    url: http://mirror-prometheus-operator-prometheus
  resources:
    limits:
      cpu: 75m
      memory: 128Mi
    requests:
      cpu: 25m
      memory: 64Mi
  rules:
    default: false
    resource:
      cpu:
        containerQuery: sum(irate(container_cpu_usage_seconds_total{<<.LabelMatchers>>,container!="POD",container!="",pod!=""}[3m])) by (<<.GroupBy>>)
        nodeQuery: sum(rate(container_cpu_usage_seconds_total{<<.LabelMatchers>>, id='/'}[3m])) by (<<.GroupBy>>)
        resources:
          overrides:
            node:
              resource: node
            namespace:
              resource: namespace
            pod:
              resource: pod
        containerLabel: container
      memory:
        containerQuery: sum(container_memory_working_set_bytes{<<.LabelMatchers>>,container!="POD",container!="",pod!=""}) by (<<.GroupBy>>)
        nodeQuery: sum(container_memory_working_set_bytes{<<.LabelMatchers>>,id='/'}) by (<<.GroupBy>>)
        resources:
          overrides:
            node:
              resource: node
            namespace:
              resource: namespace
            pod:
              resource: pod
        containerLabel: container
      window: 3m

prometheus-operator:
  alertmanager:
    service:
      type: LoadBalancer
  grafana:
    additionalDataSources:
      - name: Loki
        type: loki
        access: proxy
        url: http://mirror-loki:3100
        jsonData:
          maxLines: 500
    adminPassword: password
    defaultDashboardsEnabled: true
    service:
      type: LoadBalancer
  prometheus:
    prometheusSpec:
      retention: 90d
      serviceMonitorSelectorNilUsesHelmValues: false
      storageSpec:
        volumeClaimTemplate:
          spec:
            resources:
              requests:
                storage: 10Gi
    service:
      type: LoadBalancer

rest:
  enabled: true
  config:
    hedera:
      mirror:
        db:
          host: mirror-postgresql
