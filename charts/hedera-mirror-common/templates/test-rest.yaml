{{- if .Values.testkube.enabled -}}
{{- range $idx, $target := $.Values.testkube.test.targets }}
---
apiVersion: tests.testkube.io/v3
kind: Test
metadata:
  labels: {{ include "hedera-mirror-common.labels" $ | nindent 4 }}
  name: test-rest-{{ $target.namespace }}
  namespace: {{ $.Values.testkube.namespace }}
spec:
  content:
    repository:
      branch: {{ $.Values.testkube.test.gitBranch | default (print "v" $.Chart.AppVersion) }}
      path: hedera-mirror-test/k6
      type: git
      uri: https://github.com/hashgraph/hedera-mirror-node
    type: git-dir
  executionRequest:
    args:
      - /data/repo/hedera-mirror-test/k6/src/rest/apis.js
    artifactRequest:
      storageClassName: standard
      volumeMountPath: /share
    envConfigMaps:
      - mapToVariables: true
        mount: false
        reference:
          name: {{ include "hedera-mirror-common.fullname" $ }}-test-rest
    variables:
      BASE_URL:
        name: BASE_URL
        type: basic
        value: http://{{ $target.release }}-rest.{{ $target.namespace }}.svc.cluster.local
      TEST_REPORTS_DIR:
        name: TEST_REPORTS_DIR
        type: basic
        value: /share
  type: k6-custom/script
{{- end }}
{{- end }}
