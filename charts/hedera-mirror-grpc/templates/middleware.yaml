{{- if and .Values.global.middleware .Values.middleware -}}
apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  labels: {{ include "hedera-mirror-grpc.labels" . | nindent 4 }}
  name: {{ include "hedera-mirror-grpc.fullname" . }}
  namespace: {{ include "hedera-mirror-grpc.namespace" . }}
spec:
  chain:
    middlewares:
{{- range .Values.middleware }}
      - name: {{ include "hedera-mirror-grpc.fullname" $ }}-{{ keys . | first | kebabcase }}
{{- end }}

{{- range .Values.middleware }}
---
apiVersion: traefik.containo.us/v1alpha1
kind: Middleware
metadata:
  labels: {{ include "hedera-mirror-grpc.labels" $ | nindent 4 }}
  name: {{ include "hedera-mirror-grpc.fullname" $ }}-{{ keys . | first | kebabcase }}
  namespace: {{ include "hedera-mirror-grpc.namespace" $ }}
spec:
  {{- . | toYaml | nindent 2 }}
{{- end }}
{{- end }}
