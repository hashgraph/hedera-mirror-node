apiVersion: v1
kind: Secret
metadata:
  name: hcs-perf-message-submit-secret
stringData:
  user.properties: |-
    hedera.mirror.test.performance.clientNetworkNodes[0]=
    hedera.mirror.test.performance.clientPublishInterval[0]=10000
    hedera.mirror.test.performance.clientPublishTimeout[0]=900
    hedera.mirror.test.performance.clientMessagesPerBatchCount[0]=500
    hedera.mirror.test.performance.clientMessagesByteSize[0]=5
    hedera.mirror.test.performance.clientOperatorId[0]=
    hedera.mirror.test.performance.clientOperatorKey[0]=
---
apiVersion: batch/v1
kind: Job
metadata:
  name: hcs-perf-message-submit
  labels:
    app.kubernetes.io/name: test
spec:
  completions: 5
  parallelism: 5
  template:
    metadata:
      name: hcs-perf-message-submit
      labels:
        app.kubernetes.io/name: test
    spec:
      affinity:
        podAntiAffinity:
          preferredDuringSchedulingIgnoredDuringExecution:
            - weight: 100
              podAffinityTerm:
                topologyKey: kubernetes.io/hostname
                labelSelector:
                  matchLabels:
                    app.kubernetes.io/name: test
      restartPolicy: Never
      containers:
        - image: gcr.io/mirrornode/hedera-mirror-test:0.13.1
          name: test
          env:
            - name: testProfile
              value: "performance"
            - name: jmeterTestPlan
              value: "Topic_Message_Publish_Only.jmx"
            - name: jmeterPropsDirectory
              value: "/usr/etc/hedera-mirror-test"
            - name: publishThreadCount
              value: "100"
          volumeMounts:
            - name: message-submit-config-volume
              mountPath: /usr/etc/hedera-mirror-test
      volumes:
        - name: message-submit-config-volume
          secret:
            defaultMode: 420
            secretName: hcs-perf-message-submit-secret
