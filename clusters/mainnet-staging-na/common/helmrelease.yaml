apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
  name: mirror
  namespace: common
spec:
  chart:
    spec:
      chart: hedera-mirror-common
      sourceRef:
        kind: HelmRepository
        name: hedera-mirror-node
      version: '0.114.0-rc1'
  dependsOn:
    - name: testkube
      namespace: testkube
  driftDetection:
    mode: enabled
    ignore:
      - paths: [""]
        target:
          kind: (MutatingWebhookConfiguration|SGConfig|ValidatingWebhookConfiguration)
  install:
    crds: CreateReplace
  interval: 1m
  timeout: 10m
  upgrade:
    cleanupOnFail: true
    crds: CreateReplace
  valuesFrom:
    - kind: Secret
      name: mirror
  values:
    loki:
      loki:
        structuredConfig:
          ruler:
            external_url: https://mirrornode.grafana.net
      singleBinary:
        resources:
          limits:
            memory: 1Gi
    prometheus:
      prometheus:
        prometheusSpec:
          externalLabels:
            cluster: mainnet-staging-na
          replicaExternalLabelName: __replica__
          resources:
            limits:
              memory: 12Gi
            requests:
              memory: 10Gi
    testkube:
      enabled: true
      test:
        config:
          rest:
            DEFAULT_ACCOUNT_BALANCE: "123456"
            DEFAULT_ACCOUNT_ID: "1459478"
            DEFAULT_ACCOUNT_ID_NFTS: "1484550"
            DEFAULT_ACCOUNT_ID_TIMESTAMP: "1698181150.152"
            DEFAULT_ACCOUNT_ID_TOKEN: "1007535"
            DEFAULT_ACCOUNT_ID_TOKEN_ALLOWANCE: "1323559"
            DEFAULT_BALANCE_TIMESTAMP: "1698342740.152"
            DEFAULT_CONTRACT_ID: "1077627"
            DEFAULT_CONTRACT_RESULT_HASH: 0x8cc7f0036115d677ed3168b2812d8d78519788d0919e3975e067b8b172ca8a28
            DEFAULT_CONTRACT_TIMESTAMP: "1682635826.366674003"
            DEFAULT_DURATION: 300s
            DEFAULT_NFT_ID: "956460"
            DEFAULT_NFT_SERIAL: "893"
            DEFAULT_PUBLIC_KEY: 97c6b472d72b34598dc4f5ca20b68d40916cf9f68f32bbc3dcacebd0680fe920
            DEFAULT_SCHEDULE_ACCOUNT_ID: "1163482"
            DEFAULT_SCHEDULE_ID: "2184852"
            DEFAULT_TOKEN_ID: "2186153"
            DEFAULT_TOKEN_NAME: "sauce"
            DEFAULT_TOPIC_ID: "1693742"
            DEFAULT_TOPIC_SEQUENCE: "5098305126"
            DEFAULT_TOPIC_TIMESTAMP: "1682642567.991586003"
            DEFAULT_TRANSACTION_HASH: 0x9c7daa10348eb6de10ba5268024056db7fcb06faed49062e6e32cbc0fcbd0c0d44dc9aca800251797b179f4b189dfab9
            DEFAULT_TRANSACTION_ID: 0.0.1082181-1725646545-819106593
            DEFAULT_VUS: "1500"
          restjava:
            DEFAULT_ACCOUNT_ID_NFTS_ALLOWANCE_OWNER: "639043"
            DEFAULT_ACCOUNT_ID_NFTS_ALLOWANCE_SPENDER: "1992106"
            DEFAULT_DURATION: 300s
            DEFAULT_TOPIC_ID: "1693742"
            DEFAULT_VUS: "1500"
          web3:
            ACCOUNT_ADDRESS: "0000000000000000000000000000000000000000000000000000000000429f69"
            DEFAULT_ACCOUNT_ADDRESS: "0000000000000000000000000000000000429f69"
            DEFAULT_CONTRACT_ADDRESS: "0000000000000000000000000000000000429f6b"
            DEFAULT_DURATION: 300s
            DEFAULT_VUS: "500"
            ERC_CONTRACT_ADDRESS: "0000000000000000000000000000000000429f73"
            HTS_CONTRACT_ADDRESS: "0000000000000000000000000000000000429f7a"
            KEY_TYPE: "0000000000000000000000000000000000000000000000000000000000000001"
            NON_FUNGIBLE_TOKEN_ADDRESS: "0000000000000000000000000000000000000000000000000000000000429f75"
            SERIAL_NUMBER: "0000000000000000000000000000000000000000000000000000000000000001"
            SPENDER_ADDRESS: "0000000000000000000000000000000000000000000000000000000000429f77"
            TOKEN_ADDRESS: "0000000000000000000000000000000000000000000000000000000000429f74"
        targets:
          - namespace: mainnet-citus
            release: mirror
      trigger:
        enabled: true
    stackgres:
      enabled: true
    traefik:
      resources:
        limits:
          cpu: 600m
        requests:
          cpu: 300m
      service:
        annotations:
          cloud.google.com/neg: '{ "exposed_ports":{ "443":{"name": "mainnet-staging-na"} } }'
    zfs:
      enabled: true
      init:
        diskPrefix: mainnet-staging-na

