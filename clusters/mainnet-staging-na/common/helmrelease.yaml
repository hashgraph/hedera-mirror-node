apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: mirror
  namespace: common
spec:
  chart:
    spec:
      chart: hedera-mirror-common
      sourceRef:
        kind: HelmRepository
        name: hedera-mirror-node
      version: '0.104.0-rc4'
  dependsOn:
    - name: testkube
      namespace: testkube
  install:
    crds: CreateReplace
  interval: 1m
  timeout: 10m
  upgrade:
    cleanupOnFail: true
    crds: CreateReplace
  valuesFrom:
    - kind: Secret
      name: mirror
  values:
    loki:
      loki:
        structuredConfig:
          ruler:
            external_url: https://mirrornode.grafana.net
    prometheus:
      prometheus:
        prometheusSpec:
          externalLabels:
            cluster: mainnet-staging-na
          replicaExternalLabelName: __replica__
    testkube:
      enabled: true
      test:
        config:
          rest:
            DEFAULT_ACCOUNT_BALANCE: "123456"
            DEFAULT_ACCOUNT_ID: "1833905"
            DEFAULT_ACCOUNT_ID_NFTS: "1484550"
            DEFAULT_ACCOUNT_ID_NFTS_ALLOWANCE_OWNER: "639043"
            DEFAULT_ACCOUNT_ID_NFTS_ALLOWANCE_SPENDER: "1992106"
            DEFAULT_ACCOUNT_ID_TIMESTAMP: "1698181150.152"
            DEFAULT_ACCOUNT_ID_TOKEN: "1007535"
            DEFAULT_ACCOUNT_ID_TOKEN_ALLOWANCE: "1323559"
            DEFAULT_BALANCE_TIMESTAMP: "1698342740.152"
            DEFAULT_CONTRACT_ID: "1077627"
            DEFAULT_CONTRACT_RESULT_HASH: 0x8cc7f0036115d677ed3168b2812d8d78519788d0919e3975e067b8b172ca8a28
            DEFAULT_CONTRACT_TIMESTAMP: "1682635826.366674003"
            DEFAULT_DURATION: 300s
            DEFAULT_NFT_ID: "956460"
            DEFAULT_NFT_SERIAL: "893"
            DEFAULT_PUBLIC_KEY: 97c6b472d72b34598dc4f5ca20b68d40916cf9f68f32bbc3dcacebd0680fe920
            DEFAULT_SCHEDULE_ACCOUNT_ID: "1163482"
            DEFAULT_SCHEDULE_ID: "2184852"
            DEFAULT_TOKEN_ID: "2186153"
            DEFAULT_TOPIC_ID: "1693742"
            DEFAULT_TOPIC_SEQUENCE: "5098305126"
            DEFAULT_TOPIC_TIMESTAMP: "1682642567.991586003"
            DEFAULT_TRANSACTION_HASH: 0x8b7d19d392c477e29ef713f35451b82bd5ed65f1713951bf996ed8a41ed3100589ae2da457d5e0e8663fe364873fb7db
            DEFAULT_TRANSACTION_ID: 0.0.2186182-1682642681-835182914
            DEFAULT_VUS: "1500"
          web3:
            ACCOUNT_ADDRESS: "0000000000000000000000000000000000000000000000000000000000429f69"
            DEFAULT_ACCOUNT_ADDRESS: "0000000000000000000000000000000000429f69"
            DEFAULT_CONTRACT_ADDRESS: "0000000000000000000000000000000000429f6b"
            DEFAULT_DURATION: 300s
            DEFAULT_VUS: "500"
            ERC_CONTRACT_ADDRESS: "0000000000000000000000000000000000429f73"
            HTS_CONTRACT_ADDRESS: "0000000000000000000000000000000000429f7a"
            KEY_TYPE: "0000000000000000000000000000000000000000000000000000000000000001"
            NON_FUNGIBLE_TOKEN_ADDRESS: "0000000000000000000000000000000000000000000000000000000000429f75"
            SERIAL_NUMBER: "0000000000000000000000000000000000000000000000000000000000000001"
            SPENDER_ADDRESS: "0000000000000000000000000000000000000000000000000000000000429f77"
            TOKEN_ADDRESS: "0000000000000000000000000000000000000000000000000000000000429f74"
        target:
          namespace: mainnet
      trigger:
        enabled: true
    stackgres:
      enabled: true
    traefik:
      service:
        annotations:
          cloud.google.com/neg: '{ "exposed_ports":{ "443":{"name": "mainnet-staging-na"} } }'
    zfs:
      enabled: true
      init:
        diskPrefix: mainnet-staging-na

